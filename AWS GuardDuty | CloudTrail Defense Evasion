//AWS CloudTrail / GuardDuty log tampering

config case_sensitive = false timeframe = 7d

| dataset = amazon_aws_raw 
| filter eventName in (
    "StopLogging",
    "DeleteTrail",
    "UpdateTrail",
    "DeleteMembers",
    "DisassociateFromMasterAccount",
    "ArchiveFindings",
    "StopMonitoringMembers",
    "UpdateDetector",
    "DeleteDetector",
    "PutEventSelectors"
)
| filter errorCode = null or errorMessage = ""  // Matches successful operations (either field indicates success)
| fields _time, eventName, eventSource, userIdentity, userAgent, sourceIPAddress, awsRegion, eventID
