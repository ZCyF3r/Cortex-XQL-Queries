//S3 Bucket Logging Deletion from Non-AWS Infrastructure

config case_sensitive = false timeframe = 1d

| dataset = cloud_audit_logs 
| filter cloud_provider = ENUM.AWS
| filter operation_name_orig = "DeleteBucketLogging"
| filter operation_status = "Success"
| filter user_agent not contains "amazonaws.com"
| alter S3Bucket = json_extract_scalar(raw_log, "$.requestParameters.bucketName")
| fields _time, S3Bucket, operation_name_orig, caller_ip, caller_ip_asn, caller_ip_geolocation, identity_invoked_by_uuid, identity_name, referenced_resource, user_agent
